<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="img/general/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="img/general/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/general/favicon-16x16.png">
    <title>Pomodoro</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>



    <script src="https://www.youtube.com/iframe_api"></script>

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/pomodoro.css">
</head>
<body>

<!-- STARS-->

    <div class="night">
        <div class="shooting_star"></div>
        <div class="shooting_star"></div>
        <div class="shooting_star"></div>
        <div class="shooting_star"></div>
        <div class="shooting_star"></div>
    </div>


<!-- NAVBAR -->

    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <a class="navbar-brand" href="index.html">
            <img id="logo" src="img/general/logoblack.png" alt="Logo" height="50">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="notes.html">Notes</a></li>
                <li class="nav-item"><a class="nav-link" href="pomodoro.html">Pomodoro</a></li>
                <li class="nav-item"><a class="nav-link" href="todos.html">To-Do List</a></li>
            </ul>
            <button class="icon-button" id="colorToggle" aria-label="Change Color" onclick="toggleDarkMode()">ðŸŽ¨</button>
            
        </div>
    </nav>




<!-- Panel Container -->

    <div id="panel-container">



<!-- MUSIC PANEL -->

        <div class="p-panel" id="music-p-panel" onclick="activatePanel('music-p-panel')">
            <span class="panel-label">Music</span>
            <div class="music-content">

                <div class="music-left-section">
                    <i class="bi bi-music-note-list" id="show-playlist-button"></i> <!-- Playlist GÃ¶rÃ¼ntÃ¼leme Ä°konu -->
                    <i class="bi bi-plus-square" id="add-music-button"></i> <!-- MÃ¼zik Ekleme Ä°konu -->

                </div>

                <div class="music-right-section">

                    <div id="music-controls-section" style="display: block;">
                        <div class="music-right-top-section">
                            <div class="music-name-section">
                                <!-- MÃ¼zik adÄ± gÃ¶sterilebilir -->
                            </div>
                            <div class="music-rhythm-section">
                                <!-- MÃ¼zik ritim gÃ¶stergesi (opsiyonel) -->
                                <div id="youtube-player"></div>

                            </div>
                            <div class="music-buttons-section">
                                <button class="control-btn" id="prev"><i class="fas fa-backward"></i></button>
                                <button class="control-btn" id="playPauseButton"><i class="fas fa-play"></i></button>
                                <button class="control-btn" id="next"><i class="fas fa-forward"></i></button>
                            </div>
                            <div class="music-progress-bar-section">
                                <div class="music-progress-bar-progress-section">
                                    <span class="time time-start">00:00</span>
                                    <div class="progress-bar">
                                        <div class="progress"></div>
                                    </div>
                                    <span class="time time-end">00:00</span>
                                </div>
                                <div class="music-progress-bar-sound-section">
                                    <i class="fas fa-volume-down"></i>
                                    <input type="range" class="volume-slider" min="0" max="100" value="50">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                            </div>
                        </div>
                        <div class="music-right-bot-section">
                            <ul id="playlist">
                                
                            </ul>
                        </div>
                    </div>
                
                    
                    <div id="add-music-section" style="display: none;">
                        
                        <form id="addMusicForm">
                            <input type="text" id="musicName" placeholder="Music name" required>
                            <input type="url" id="youtubeLink" placeholder="YouTube Link" required>
                            <button type="submit">Add</button>
                        </form>
                    </div>

                </div>

            </div>
        </div>





<!-- HISTORY PANEL -->

        <div class="p-panel" id="history-p-panel" onclick="activatePanel('history-p-panel')">
            <span class="panel-label">History</span>
            <div class="history-content">

                <div id="history-container">
                    

                </div>
            
            </div>
        </div>





<!-- POMODORO PANEL -->

        <div class="p-panel" id="pomodoro-p-panel" onclick="activatePanel('pomodoro-p-panel')">
            <span class="panel-label">Pomodoro</span>
            <div class="pomodoro-content">

                <div class="pomodoro-mode-section">

                    <div class="pomodoro-mode-pomodoro-section">
                        <button onclick="selectMode('pomodoro')" class="pomodoro-symbol">
                            <span>25/5</span>
                        </button>
                    </div>

                    <div class="pomodoro-mode-countdown-section">
                        <button onclick="selectMode('countdown')">
                            <i class="fas fa-hourglass-half"></i> 
                        </button>
                    </div>

                    <div class="pomodoro-mode-stopwatch-section">
                        <button onclick="selectMode('stopwatch')">
                            <i class="fas fa-stopwatch"></i> 
                        </button>
                    </div>

                </div>

                <div class="pomodoro-content-section">


                <!-- Sol BÃ¶lÃ¼m -->
                <div id="left-section">
                    
                    
                    <div id="circular-timer">
                        <div id="progress-circle"></div>
                        <div id="content">
                            <img id="plant-stage" src="img/pomodoro/plants/olive-tree/stage1.png" alt="Plant Stage">

                        </div>
                    </div>
                    <div>
                        <p></p>
                        <div id="timer-display">00:00</div>
                        <button id="start-button" onclick="startTimer()">Start</button>
                        <button id="stop-button" onclick="stopTimer()" style="display: none;">Finish</button>
                    </div>
                    
                
                    <button id="toggle-settings" onclick="toggleSettings()">></button>
                </div>
                
                
                <div id="right-section">
                    
                    <div id="pomodoro-settings">
                        <p>Pomodoro Count:</p>
                        <input type="number" id="pomodoro-count" min="1" value="4">
                        <p>Pomodoro Duration(m):</p>
                        <input type="number" id="pomodoro-duration" min="1" value="25">
                        <p>Break (m):</p>
                        <input type="number" id="break-duration" min="1" value="5">
                    </div>
                
                    
                    <div id="countdown-settings" style="display: none;">
                        <p>Countdown Duration (m):</p>
                        <input type="number" id="countdown-duration" min="1" value="30">
                    </div>
                
                    
                    <div id="stopwatch-settings" style="display: none;">
                        <p>Just start from 0 and continue.</p>
                    </div>
                    
                    <button id="apply-settings" onclick="applySettings()">Apply</button>
                </div>
                

                </div>
                
            </div>
        </div>




<!-- PLANT SETTINGS PANEL-->


        <div class="p-panel" id="plant-settings-p-panel" onclick="activatePanel('plant-settings-p-panel')">
            <span class="panel-label">Plants</span>
            <div class="p-panel-content">
                <h1 class="panel-title">Plant Species</h1> <!-- Title -->
                <span class="plant-name">Olive Tree</span>

                <!-- Plant List -->
                <div class="plant-list">
                    <!-- Single Plant Item -->
                    <div class="plant-list-item">
                        <div class="plant-image-circle">
                            <img src="img/pomodoro/plants/olive-tree/stage1.png" alt="Olive Tree">
                        </div>
                    
                    </div>
                    <div class="plant-list-item">
                        <div class="plant-image-circle">
                            <img src="img/pomodoro/plants/olive-tree/stage2.png" alt="Olive Tree">
                        </div>
                        
                    </div>
                    <div class="plant-list-item">
                        <div class="plant-image-circle">
                            <img src="img/pomodoro/plants/olive-tree/stage3.png" alt="Olive Tree">
                        </div>
                        
                    </div>
                    <div class="plant-list-item">
                        <div class="plant-image-circle">
                            <img src="img/pomodoro/plants/olive-tree/stage4.png" alt="Olive Tree">
                        </div>
                    </div>
                    <div class="plant-list-item">
                        <div class="plant-image-circle">
                            <img src="img/pomodoro/plants/olive-tree/stage5.png" alt="Olive Tree">
                        </div>
                    
                    </div>
                </div>


                <!-- Footer -->
                <div class="plant-footer">
                    <p style="font-family: 'Chewy';">New trees on the way...</p>
                </div>
            </div>
        </div>





<!-- COLLECTION PANEL -->

        <div class="p-panel" id="collection-p-panel" onclick="activatePanel('collection-p-panel')">
            <span class="panel-label">Collection</span>
            <div class="p-panel-content">

                <div id="total-trees" style="margin: 20px; color: gray;">
                    <h1>Total Trees: <span id="tree-count" style="color: #137661;">0</span></h1>
                </div>
                

            </div>
        </div>




<!-- HORIZONS PANEL -->

        <div class="p-panel" id="horizons-p-panel" onclick="activatePanel('horizons-p-panel')">
            <span class="panel-label">Horizons</span>
            <div class="p-panel-content">

                <h1 style="font-family: 'Chewy'; color: #137661;">COMING SOON</h1>

            </div>
        </div>




<!-- WORLDS PANEL -->

        <div class="p-panel" id="worlds-p-panel" onclick="activatePanel('worlds-p-panel')">
            <span class="panel-label">Worlds</span>
            <div class="p-panel-content">

                <h1 style="font-family: 'Chewy'; color: #137661;">COMING SOON</h1>

            </div>
        </div>

    </div>



<!-- SCRIPTS -->    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        activatePanel('pomodoro-p-panel'); // open omodoro panel
    });
</script>

<script>
    let player; // YouTube Player instance
    let isPlaying = false;
    let progressInterval;

    // YouTube API Script Loading
    if (!window.YT) {
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    } else if (window.YT && YT.Player) {
        onYouTubeIframeAPIReady(); // Call directly if API already loaded
    }

    // YouTube IFrame API Ready
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
            height: '360',
            width: '640',
            videoId: 'kIBdpFJyFkc', 
            events: {
                onReady: onPlayerReady,
                onStateChange: onPlayerStateChange,
            },
        });
    }

    // Player Ready
    function onPlayerReady(event) {
        const playPauseButton = document.getElementById('playPauseButton');
        playPauseButton.addEventListener('click', () => {
            if (isPlaying) {
                player.pauseVideo();
                playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                player.playVideo();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            }
            isPlaying = !isPlaying;
        });
    }

    // Update Progress Bar
    function updateProgressBar() {
    const progressBar = document.querySelector('.progress');
    const currentTime = player.getCurrentTime();
    const duration = player.getDuration();

    // error control
    const validCurrentTime = isNaN(currentTime) ? 0 : currentTime;
    const validDuration = isNaN(duration) || duration === 0 ? 0 : duration;

    if (progressBar && validDuration > 0) {
        const progressPercent = (validCurrentTime / validDuration) * 100;
        progressBar.style.width = `${progressPercent}%`;

        const timeStart = document.querySelector('.time-start');
        const timeEnd = document.querySelector('.time-end');
        if (timeStart && timeEnd) {
            timeStart.textContent = formatVideoTime(validCurrentTime);
            timeEnd.textContent = formatVideoTime(validDuration);
        }
    } else {
        // DeÄŸerler geÃ§ersizse varsayÄ±lan 00:00 gÃ¶ster
        document.querySelector('.time-start').textContent = "00:00";
        document.querySelector('.time-end').textContent = "00:00";
    }
}


    // Start Updating Progress Bar
    function startUpdatingProgressBar() {
        clearInterval(progressInterval);
        progressInterval = setInterval(updateProgressBar, 500); // Update every 500ms
    }

    // Stop Updating Progress Bar
    function stopUpdatingProgressBar() {
        clearInterval(progressInterval);
    }

    // Handle Player State Change
    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            startUpdatingProgressBar();
        } else {
            stopUpdatingProgressBar();
        }
    }

    // Format Time (mm:ss)
    function formatVideoTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // Allow Click on Progress Bar to Seek Video
    const progressBarContainer = document.querySelector('.progress-bar');
    progressBarContainer.addEventListener('click', (event) => {
        const progressBarWidth = progressBarContainer.offsetWidth;
        const clickX = event.offsetX;
        const duration = player.getDuration();

        if (duration > 0) {
            const newTime = (clickX / progressBarWidth) * duration;
            player.seekTo(newTime);
        }
    });


    //VOLUME SLIDER PART

    const volumeSlider = document.querySelector('.volume-slider');

// Update YouTube player volume when volume slider changes
volumeSlider.addEventListener('input', (event) => {
    const volume = event.target.value;
    player.setVolume(volume); 
});

// YouTube - volume slider sync
function syncVolumeSlider() {
    const currentVolume = player.getVolume(); 
    volumeSlider.value = currentVolume; 
}

// Update slider to YouTube volume when player is ready
function onPlayerReady(event) {
    syncVolumeSlider(); 

    const playPauseButton = document.getElementById('playPauseButton');
    playPauseButton.addEventListener('click', () => {
        if (isPlaying) {
            player.pauseVideo();
            playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
        } else {
            player.playVideo();
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
        }
        isPlaying = !isPlaying;
    });
}


</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="js/pomodoro.js"></script>
<script src="js/script.js"></script>
</body>
</html>
